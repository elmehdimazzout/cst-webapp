{% extends 'base.html' %}
{% load static %}
{% block title %}Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©{% endblock %}
{% block TitlePage %}Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø²ÙŠÙ„{% endblock %}

{% block content %}
    <div class="container mt-5">
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <div>
               ØªÙ†Ø¨ÙŠÙ‡:
            ÙŠØ¬Ø¨ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø²ÙŠÙ„ Ø¨Ø³Ø±ÙŠØ© ØªØ§Ù…Ø© ÙˆØ§Ø­ØªØ±Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ù‡Ø§ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©ØŒ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙ‚Ø· Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

        </div>
    </div>
        <div class="card">
            <div class="card-body">
                <h5 class="card-header  text-center">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù†Ø²ÙŠÙ„</h5>
                <table class="table  ">
                    <tbody>
                        <tr>
                            <th>Ø§Ù„Ø¥Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                            <td>{{ patient.nom_prenom }} 
                                
                                
                            </td>
                        </tr>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙ</th>
                            <td>{{ patient.Cin }}</td>
                        </tr>
                        <tr>
                            <th>Ø§Ù„Ø¬Ù†Ø³</th>
                            <td>{{ patient.sexe }}</td>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©:</th>
                            <td>{{ patient.etat_matrimonial }}</td>
                        </tr>
                        <tr>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø²Ø¯ÙŠØ§Ø¯</th>
                            <td>{{ patient.date_naissance|date:"d/m/Y" }}</td>
                            <th>Ø§Ù„Ø³Ù†:</th>
                            <td>{{ patient.date_naissance|timesince }}</td>

                        </tr>
                        <tr>
                            <th>Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ø²Ø¯ÙŠØ§Ø¯</th>
                            <td>{{ patient.lieu_naissance }}</td>
                        </tr>
                        <tr>
                            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                            <td>{{ patient.adresse }}</td>
                        </tr>
                    </tbody>
                </table>

                    <h5 class="card-header  text-center">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h5>
                    <table class="table  ">
                        <tbody>
                            <tr>
                                <th>Ø¥Ø³Ù… Ø§Ù„Ø£Ø¨</th>
                                <td>{{ patient.nom_pere }}</td>
                                <th>Ø¥Ø³Ù… Ø§Ù„Ø£Ù…</th>
                                <td>{{ patient.nom_mere }}</td>
                            </tr>

                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø§ØªÙ</th>
                                <td>{{ patient.telephone }}</td>
                            </tr>
                        </tbody>
                    </table>

                    <h5 class="card-header  text-center">Ø§Ù„Ù…Ø¨ÙŠØª  </h5>
                    <table class="table  ">
                        <tbody>
                            <tr>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø¨ÙŠØª </th>
                                <td>{{ patient.suite_couchage }}</td>
                                <th>Ø§Ù„ØºØ±ÙØ©  </th>
                                <td>{{ patient.chambre }}</td>
                            </tr>

                        </tbody>
                    </table>
                    <h5 class="card-header  text-center">Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© - Ø§Ù„ÙˆÙØ§Ø©  </h5>
                    <table class="table  ">
                        <tbody>
                            <tr>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„ </th>
                                <td>{{ patient.date_entree|date:"d/m/Y" }}</td>
                                <th>Ø§Ù„Ù…ØµØ¯Ø±  </th>
                                <td>{{ patient.source_orientation }}</td>
                            </tr>
                            <tr>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© </th>
                                <td>{{ patient.date_sortie|date:"d/m/Y" }}</td>
                                <th>Ø³Ø¨Ø¨ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©  </th>
                                <td>{{ patient.raison_depart }}</td>
                                <th>Ø§Ù„Ù…Ø±Ø§ÙÙ‚</th>
                                <td>{{ patient.son_compagnon }}</td>

                            </tr>
                            <tr>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙØ§Ø© </th>
                            <td>
                                {% if patient.date_deces %}
                                    {{ patient.date_deces|date:"d/m/Y" }}
                                {% else %}
                                    <span style="color: green;"> Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø©</span>
                                {% endif %}
                            </td>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„ÙˆÙØ§Ø©   </th>
                                <td>{{ patient.lieu_deces }}</td>
                            </tr>
                        </tbody>
                    </table>
                    <h5 class="card-header  text-center">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ©    </h5>
                    <table class="table  table-bordered ">
                        <thead>
                            <tr>                    
                              <th scope="col">Ù…Ø±Ø¶ Ù†ÙØ³ÙŠ </th>
                              <th scope="col">Ù…Ø±Ø¶ Ø§Ù„Ø³ÙƒØ±ÙŠ </th>
                              <th scope="col">Ø¶ØºØ· Ø§Ù„Ø¯Ù… 	</th>
                              <th scope="col">Ø§Ù„Ø³Ù„ 	</th>
                              <th scope="col">Ù…Ø±Ø¶ Ø§Ù„Ø³Ø±Ø·Ø§Ù† </th>
                            </tr>
                          </thead>
                        <tbody>
                            <tr>
                                <td>{{ patient.maladie_mentale }}</td>
                                <td>{{ patient.diabete }}</td>
                                <td>{{ patient.pression_arterielle }}</td>
                                <td>{{ patient.tuberculose }}</td>
                                <td>{{ patient.tumeurs }}</td>
                            </tr>

                        </tbody>
                    </table>
                    <h5 class="card-header  text-center">Ø¥Ø¹Ø§Ù‚Ø© Ø¬Ø³Ø¯ÙŠØ©   </h5>
                    <table class="table  table-bordered ">
                        <thead>
                            <tr>
                              <th scope="col">Ø¥Ø¹Ø§Ù‚Ø© Ø­Ø±ÙƒÙŠØ©</th>
                              <th scope="col">Ø£ØµÙ… ÙˆØ£Ø¨ÙƒÙ…	</th>
                              <th scope="col">Ø¶Ø¹Ù Ø§Ù„Ø¨ØµØ±	</th>
                              <th scope="col">Ø£Ø·Ø±Ø§Ù Ù…Ø¨ØªÙˆØ±Ø©</th>
                            </tr>
                          </thead>
                        <tbody>
                            <tr>
                                <td>{{ patient.handicap_moteur }}</td>
                                <td>{{ patient.sourd_muet }}</td>
                                <td>{{ patient.deficience_visuelle }}</td>
                                <td>{{ patient.membres_amputes }}</td>
                            </tr>

                        </tbody>
                    </table>
                    <div class="text-center mt-3">

                        <a href="{% url 'edit_patient' patient.id %}" class="btn btn-success">ØªØ¹Ø¯ÙŠÙ„ </a>
                        <button class="delete-btn btn btn-danger" data-id="{{ patient.id }}">ğŸ—‘ï¸ Ø­Ø°Ù</button>

                    </div>
                    
            </div>
        </div>
    </div>
    
    <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'js/sweetalert2@11.js' %}"></script>
    
    <script>
        $(document).ready(function(){
            $(".delete-btn").click(function(event){
                event.preventDefault(); // âŒ Ù…Ù†Ø¹ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                
                var patientId = $(this).data("id");
                var row = $("#patient-row-" + patientId);
    
                // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ù…Ø¹ Ø§Ù„ØªØ­Ø°ÙŠØ±
                Swal.fire({
                    title: "âš ï¸ ØªØ­Ø°ÙŠØ±!",
                    html: "<b>Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ­Ù…Ù„Ùƒ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©</b><br>Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙˆÙ† Ø¥Ø°Ù† Ù…Ø³Ø¨Ù‚ØŒ ÙØ£Ù†Øª ØªØªØ­Ù…Ù„ Ø§Ù„Ø¹ÙˆØ§Ù‚Ø¨!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    cancelButtonColor: "#3085d6",
                    confirmButtonText: "Ù†Ø¹Ù…ØŒ Ø£ØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©!",
                    cancelButtonText: "Ø¥Ù„ØºØ§Ø¡"
                }).then((result) => {
                    if (result.isConfirmed) {
                        // âœ… Ø¬Ù„Ø¨ CSRF Token
                        var csrftoken = "{{ csrf_token }}";
                        
                        $.ajax({
                            url: "/" + patientId + "/delete/",
                            type: "POST",
                            headers: { "X-CSRFToken": csrftoken },
                            success: function(response) {
                                if(response.success) {
                                    row.fadeOut(500, function() { $(this).remove(); });
    
                                    // âœ… Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
                                    Swal.fire({
                                        title: "ØªÙ… Ø§Ù„Ø­Ø°Ù!",
                                        text: "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.",
                                        icon: "success",
                                        timer: 2000, // â³ Ø§Ù†ØªØ¸Ø§Ø± 2 Ø«ÙˆØ§Ù†ÙŠ
                                        showConfirmButton: false
                                    });
    
                                    // â³ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ 2 Ø«ÙˆØ§Ù†ÙŠ
                                    setTimeout(function(){
                                        window.location.href = "/list"; // ğŸ”„ ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                                    }, 2000);
                                } else {
                                    Swal.fire("Ø®Ø·Ø£!", response.error, "error");
                                }
                            },
                            error: function(xhr) {
                                Swal.fire("Ø®Ø·Ø£!", "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù! (" + xhr.responseText + ")", "error");
                            }
                        });
                    }
                });
            });
        });
    </script>
    

    {% endblock %}
